### Azure Kubernetes Services (AKS) - Storage Deep Dive (Lvl 300) 

Repo with all the content needed for the AKS Storage Deep Dive session.

![alt text](./img/banner.jpeg)
<small> Image generated by AI

## Table of Contents
1. [Pre-Requirements](#1-pre-requirements)
2. [Environment Setup](#2-environment-setup)
3. [Lab 1: Provision/enable CSI Storage Drivers and Stress Testing](#3-lab-1-provisionenable-csi-storage-drivers-and-stress-testing)
4. [Lab 2: Provision/enable Azure Elastic SAN in an existing AKS Cluster and Stress Testing](#4-lab-2-provisionenable-azure-elastic-san-in-an-existing-aks-cluster-and-stress-testing)
5. [Lab 3: Provision/enable Azure Container Storage in an AKS Cluster and Stress Testing](#5-lab-3-provisionenable-azure-container-storage-in-an-aks-cluster-and-stress-testing)
6. [Lab 4: Manage and expand Ephemeral storage](#6-lab-4-manage-and-expand-ephemeral-storage)
7. [Lab 5: Provision/enable NetApp Files NFS volumes, SMB volumes and dual-protocol volumes](#7-lab-5-provisionenable-netapp-files-nfs-volumes-smb-volumes-and-dual-protocol-volumes)
8. [Lab 6: Provision/enable NVMe PV in AKS Nodepool and do some stress testing](#8-lab-6-provisionenable-nvme-pv-in-aks-nodepool-and-do-some-stress-testing)
9. [Lab 7: Configure Backup on a cluster and how to use Resource Modification to patch backed-up](#9-lab-7-configure-backup-on-a-cluster-and-how-to-use-resource-modification-to-patch-backed-up)
10. [Lab 8: Configure Velero using Azure Blob Storage on a cluster](#10-lab-8-configure-velero-using-azure-blob-storage-on-a-cluster)

## 1. Pre-Requirements
- **Azure Subscription** - [Signup for a free account.](https://azure.microsoft.com/free/)
- **Visual Studio Code** - [Download it for free.](https://code.visualstudio.com/download)
- **GitHub Account** - [Signup for a free account.](https://github.com/signup)
- **AKS Cluster** - [Learn about the Service.](https://azure.microsoft.com/en-us/products/kubernetes-service)
- **Azure CLI** - [Download it for free.](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)

## 2. Environment Setup
### 2.1. Create Azure resources

In this step, we'll **provision Azure resources** for our Lab, and put it ready to use.
- AKS (Azure Kubernetes Services) - CNI Overlay Network Plugin & Standard API

### Run this Lab with GitHub Codespaces

This repo also includes [DevContainer configuration](./.devcontainer/devcontainer.json), so you can open the repo using [GitHub Codespaces](https://docs.github.com/en/codespaces/overview). This will allow you to run all these Lab exercises, without having to install or having any extension being used on your local machine. When the Codespace is created, you can run the steps using the same instructions as below.

This is an optional step, and you can skip it if you want to run the Labs on your local machine.

### 2.2. Prepare the local environment (Local Machine or GitHub Codespaces)

Please check the **[pre-requisites](pre-requisites.md)** file for the setup of the environment.

After running all the pre-requisites, please follow the below steps

### 2.2.1. Clone the repository (Local Machine only)

```bash
git clone
cd aks-storage-deep-dive
```

### 2.2.2. Login into the cluster
```bash
#login into the AKS Cluster
az account set --subscription $SUBSCRIPTION_ID
az aks get-credentials --resource-group $RESOURCE_GROUP --name $CLUSTER --overwrite-existing
```

### 2.2.3. Deploy an Application

The application used in the next steps is the AKS Store Demo application, that can be found on the below repo. 

This sample demo app consists of a group of containerized microservices that can be easily deployed into an Azure Kubernetes Service (AKS) cluster. This is meant to show a realistic scenario using a polyglot architecture, event-driven design, and common open source back-end services (eg - RabbitMQ, MongoDB). The application also leverages OpenAI's GPT-3 models to generate product descriptions. This can be done using either [Azure OpenAI](https://learn.microsoft.com/azure/ai-services/openai/overview) or [OpenAI](https://openai.com/). We will not be using the OpenAI part of the application in this Lab.

This application is inspired by another demo app called [Red Dog](https://github.com/Azure/reddog-code).

> &#8505; **Note**
> This is not meant to be an example of perfect code to be used in production, but more about showing a realistic application running in AKS. 


**Github Repo:** [AKS Store Demo](https://github.com/Azure-Samples/aks-store-demo)


```bash	
# create the namespace where the demo app will be deployed
kubectl create ns aksappga
```

```bash
# deploy the app into the namespace
kubectl apply -f https://raw.githubusercontent.com/Azure-Samples/aks-store-demo/main/aks-store-all-in-one.yaml -n aksappga
```

```bash
# expose the store-front service via unmanaged nginx ingress controller
kubectl apply -f .\nginx-ingress.yaml
```

```bash
# get the public IP of the ingress controller
kubectl get svc ingress-nginx-controller -n ingress-nginx -o jsonpath='{.status.loadBalancer.ingress[0].ip}'
```

```bash	
# curl the store-front service
curl http://<ingress-ip>
```

## 3. Lab 1: Provision/enable CSI Storage Drivers and Stress Testing

## 4. Lab 2: Provision/enable Azure Elastic SAN in an existing AKS Cluster and Stress Testing

## 5. Lab 3: Provision/enable Azure Container Storage in an AKS Cluster and Stress Testing

## 6. Lab 4: Manage and expand Ephemeral storage

## 7. Lab 5: Provision/enable NetApp Files NFS volumes, SMB volumes and dual-protocol volumes

## 8. Lab 6: Provision/enable NVMe PV in AKS Nodepool and do some stress testing

## 9. Lab 7: Configure Backup on a cluster and how to use Resource Modification to patch backed-up

## 10. Lab 8: Configure Velero using Azure Blob Storage on a cluster